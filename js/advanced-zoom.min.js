// advanced-zoom - 1.2.1 (http://heavybeard.github.io/advanced-zoom/dist/)
+function(){"use strict";var t,e,i,a,o;function n(t){var e=t.getBoundingClientRect();var i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,a=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return{top:e.top+i,left:e.left+a}}function s(t,e){t.style.webkitTransform=e;t.style.msTransform=e;t.style.transform=e}function r(t,e){if(!("transition"in document.body.style))return e;t.addEventListener("transitionend",e);t.addEventListener("webkitTransitionEnd",e)}function d(){this._activeAdvancedZoom=this._initialScrollPosition=this._initialTouchPosition=this._touchMoveListener=null;this._window=window;this._document=document;this._body=document.body}d.prototype.listen=function(){document.body.addEventListener("click",function(t){if(t.target.getAttribute("data-zoom")==="zoom")this._advancedZoom(t)}.bind(this))};d.prototype._advancedZoom=function(o){var n=o.target;if(!n||n.tagName!=="IMG"&&n.tagName!=="VIDEO"&&n.tagName!=="PICTURE")return;if(this._body.classList.contains("zoom-overlay-open"))return;if(o.metaKey||o.ctrlKey)return window.open(o.target.getAttribute("data-zoom-original")||o.target.currentSrc||o.target.src,"_blank");if(n.width>=window.innerWidth-c.OFFSET)return;this._activeAdvancedZoomClose(true);this._activeAdvancedZoom=new c(n);this._activeAdvancedZoom.advancedZoomMedia(n.tagName);t=this._scrollHandler.bind(this);e=this._clickHandler.bind(this);i=this._keyHandler.bind(this);a=this._touchStart.bind(this);this._window.addEventListener("scroll",t);this._document.addEventListener("click",e);this._document.addEventListener("keyup",i);this._document.addEventListener("touchstart",a);this._document.addEventListener("touchend",e);o.stopPropagation()};d.prototype._activeAdvancedZoomClose=function(o){if(!this._activeAdvancedZoom)return;if(o)this._activeAdvancedZoom.dispose();else this._activeAdvancedZoom.close();this._window.removeEventListener("scroll",t);this._document.removeEventListener("click",e);this._document.removeEventListener("keyup",i);this._document.removeEventListener("touchstart",a);this._activeAdvancedZoom=null};d.prototype._scrollHandler=function(t){var e;if(this._initialScrollPosition===null)this._initialScrollPosition=window.pageYOffset;e=this._initialScrollPosition-window.pageYOffset;if(Math.abs(e)>=40)this._activeAdvancedZoomClose()};d.prototype._keyHandler=function(t){if(t.keyCode==27)this._activeAdvancedZoomClose()};d.prototype._clickHandler=function(t){t.stopPropagation();t.preventDefault();this._activeAdvancedZoomClose()};d.prototype._touchStart=function(t){this._initialTouchPosition=t.touches[0].pageY;o=this._touchMove.bind(this);t.target.addEventListener("touchmove",o)};d.prototype._touchMove=function(t){if(Math.abs(t.touches[0].pageY-this._initialTouchPosition)>10){this._activeAdvancedZoomClose();t.target.removeEventListener("touchmove",o)}};function c(t){this._fullHeight=this._fullWidth=this._overlay=this._targetMediaWrap=null;this._targetMedia=t;this._body=document.body}c.OFFSET=80;c._MAX_WIDTH=2560;c._MAX_HEIGHT=4096;c.prototype.advancedZoomMedia=function(t){var e=this._targetMedia;var i=e.getAttribute("data-zoom-original")||e.currentSrc||e.src;e.classList.add("zoom-media-loading");if(t==="IMG"||t==="PICTURE"){var a=document.createElement("img");a.onload=function(){this._fullHeight=Number(a.height);this._fullWidth=Number(a.width);this._advancedZoomOriginal();e.classList.remove("zoom-media-loading");e.removeAttribute("data-zoom-original")}.bind(this);a.src=i}else if(t==="VIDEO"){var o=document.createElement("video");var n=document.createElement("source");var s=this;o.appendChild(n);o.addEventListener("canplay",function(){s._fullHeight=Number(o.videoHeight);s._fullWidth=Number(o.videoWidth);s._advancedZoomOriginal();s._targetMedia.play();s._targetMedia.classList.remove("zoom-media-loading")},false);n.src=i}e.src=i};c.prototype._advancedZoomOriginal=function(){this._targetMediaWrap=document.createElement("div");this._targetMediaWrap.className="zoom-media-wrap";this._targetMedia.parentNode.insertBefore(this._targetMediaWrap,this._targetMedia);this._targetMediaWrap.appendChild(this._targetMedia);this._targetMedia.classList.add("zoom-media");this._targetMedia.setAttribute("data-zoom","zoom-out");this._overlay=document.createElement("div");this._overlay.className="zoom-overlay";document.body.appendChild(this._overlay);this._calculateAdvancedZoom();this._triggerAnimation()};c.prototype._calculateAdvancedZoom=function(){this._targetMedia.offsetWidth;var t=this._fullWidth;var e=this._fullHeight;var i=window.pageYOffset;var a=t/(this._targetMedia.width||this._targetMedia.videoWidth);var o=window.innerHeight-c.OFFSET;var n=window.innerWidth-c.OFFSET;var s=t/e;var r=n/o;if(t<n&&e<o)this._mediaScaleFactor=a;else if(s<r)this._mediaScaleFactor=o/e*a;else this._mediaScaleFactor=n/t*a};c.prototype._triggerAnimation=function(){this._targetMedia.offsetWidth;var t=n(this._targetMedia),e=window.pageYOffset;var i=e+window.innerHeight/2,a=window.innerWidth/2,o=t.top+(this._targetMedia.height||this._targetMedia.offsetHeight)/2,r=t.left+(this._targetMedia.width||this._targetMedia.offsetWidth)/2;this._translateY=Math.round(i-o);this._translateX=Math.round(a-r);var d="scale("+this._mediaScaleFactor+")",c="translate("+this._translateX+"px, "+this._translateY+"px) translateZ(0)";s(this._targetMedia,d);s(this._targetMediaWrap,c);this._body.classList.add("zoom-overlay-open")};c.prototype.close=function(){this._body.classList.remove("zoom-overlay-open");this._body.classList.add("zoom-overlay-transitioning");s(this._targetMedia,"");s(this._targetMediaWrap,"");r(this._targetMedia,this.dispose.bind(this))};c.prototype.dispose=function(){if(this._targetMediaWrap&&this._targetMediaWrap.parentNode){this._targetMedia.classList.remove("zoom-media");this._targetMedia.setAttribute("data-zoom","zoom");this._targetMediaWrap.parentNode.replaceChild(this._targetMedia,this._targetMediaWrap);this._overlay.parentNode.removeChild(this._overlay);this._body.classList.remove("zoom-overlay-transitioning");if(this._targetMedia.tagName==="VIDEO"&&this._targetMedia.getAttribute("data-zoom-play")==="always")this._targetMedia.play()}};(new d).listen()}();
